document.addEventListener("DOMContentLoaded",(function(){var e=[].slice.call(document.querySelectorAll("img.lazy")),t=[].slice.call(document.querySelectorAll(".lazy-background")),a=[].slice.call(document.querySelectorAll("[data-bg]"));if("IntersectionObserver"in window){let n=new IntersectionObserver((function(e,t){e.forEach((function(e){if(e.isIntersecting){let t=e.target;t.src=t.dataset.src,t.srcset=t.dataset.srcset,t.classList.remove("lazy"),n.unobserve(t)}}))}));e.forEach((function(e){n.observe(e)}));let c=new IntersectionObserver((function(e,t){e.forEach((function(e){e.isIntersecting&&(e.target.classList.add("visible"),c.unobserve(e.target))}))}));t.forEach((function(e){c.observe(e)}));let o=new IntersectionObserver((function(e,t){e.forEach((function(e){if(e.isIntersecting){let t=e.target;t.style.backgroundImage="url("+t.dataset.bg+")",o.unobserve(t)}}))}));a.forEach((function(e){o.observe(e)}))}else e.forEach((function(e){e.src=e.dataset.src,e.srcset=e.dataset.srcset})),t.forEach((function(e){e.classList.add("visible")})),a.forEach((function(e){e.style.backgroundImage="url("+e.dataset.bg+")"}))})),createBlockDate(),getCategories(),getCities("city");var searchName=document.querySelector("#event_name"),searchLocation=document.querySelector("#city"),modalNotFound=document.querySelector(".container_modal_notfound"),closeModalNotfound=document.querySelector(".close_modal_notfound");closeModalNotfound.addEventListener("click",(function(){modalNotFound.style.display="none",document.location.href="/"}));let btnSearch=document.querySelector(".btn_search");function viewEvent(e){console.log("ID",e),console.log(window.location.href);let t=window.location.href+"event-page.html?id="+e;window.open(t)}function createEventCard(e){let t=' <div class="event_card_content">\n\t<div class="block_event_img">\n\t\t<img src="https://eventafisha.com/storage/'+e.images+'" alt="'+sliceText(e.title,20)+'" class="event_card_img">\n\t</div>\n\n\t<div class="event_card_title">'+sliceText(e.title,60)+'</div>\n\t<div class="event_card_desc">'+sliceText(e.desc,120)+'</div>\n\t<div class="card_icon_title">\n\t\t<svg xmlns="http://www.w3.org/2000/svg" class="event_card_icon" viewBox="0 0 24 24"><path d="M17 3v-2c0-.552.447-1 1-1s1 .448 1 1v2c0 .552-.447 1-1 1s-1-.448-1-1zm-12 1c.553 0 1-.448 1-1v-2c0-.552-.447-1-1-1-.553 0-1 .448-1 1v2c0 .552.447 1 1 1zm13 13v-3h-1v4h3v-1h-2zm-5 .5c0 2.481 2.019 4.5 4.5 4.5s4.5-2.019 4.5-4.5-2.019-4.5-4.5-4.5-4.5 2.019-4.5 4.5zm11 0c0 3.59-2.91 6.5-6.5 6.5s-6.5-2.91-6.5-6.5 2.91-6.5 6.5-6.5 6.5 2.91 6.5 6.5zm-14.237 3.5h-7.763v-13h19v1.763c.727.33 1.399.757 2 1.268v-9.031h-3v1c0 1.316-1.278 2.339-2.658 1.894-.831-.268-1.342-1.111-1.342-1.984v-.91h-9v1c0 1.316-1.278 2.339-2.658 1.894-.831-.268-1.342-1.111-1.342-1.984v-.91h-3v21h11.031c-.511-.601-.938-1.273-1.268-2z"/></svg>\n\t\t<div class="card_title">'+new Date(e.start_date).toLocaleDateString()+'</div>\n\t</div>\n\t<div class="card_icon_title">\n\t\t<svg xmlns="http://www.w3.org/2000/svg" class="event_card_icon" viewBox="0 0 24 24"><path d="M12 0c-4.198 0-8 3.403-8 7.602 0 4.198 3.469 9.21 8 16.398 4.531-7.188 8-12.2 8-16.398 0-4.199-3.801-7.602-8-7.602zm0 11c-1.657 0-3-1.343-3-3s1.343-3 3-3 3 1.343 3 3-1.343 3-3 3z"/></svg>\n\t\t<div class="card_title">'+e.address+'</div>\n\t</div>\n\t<div class="event_card_cat">'+e.category.title+'</div>\n\t<input class="btn_buy_ticket" type="submit" value="Купить билет" onclick="viewEvent('+e.id+')">\n  </div>',a=document.querySelector(".container_events"),n=document.createElement("li");n.className="event_card",n.innerHTML=t,a.append(n)}function getCities(e){axios.get("https://eventafisha.com/api/v1/cities").then((function(t){for(let a in t.data)addOptionSelect(t.data[a],e)})).catch((function(e){console.log(e)})).then((function(){}))}function addOptionSelect(e,t){let a=document.getElementById(t),n=document.createElement("option");n.value=e.id,n.innerHTML=e.title,a.add(n)}function createBlockDate(){for(let t=0;t<6;t++){var e=new Date;let a=e.setDate(e.getDate()+t);moment.locale("ru"),console.log(moment(a).format("DD")),console.log(moment(a).format("dd")),console.log(moment(a).format("DD.MM.YYYY")),createSearchDays(moment(a).format("dd"),moment(a).format("DD"),moment(a).format("DD.MM.YYYY"))}}function createSearchDays(e,t,a){let n;n="сб"===e||"вс"===e?'\n\t\t<div class="name_day red_text">'+e+'</div>\n\t\t<div class="count_day">'+t+"</div>\n\t":'\n\t\t<div class="name_day">'+e+'</div>\n\t\t<div class="count_day">'+t+"</div>\n\t";let c=document.querySelector(".block_search_day"),o=document.createElement("div");o.className="item_search_date",o.innerHTML=n,c.append(o),addEventElementDate(o,a)}function addEventElementDate(e,t){e.addEventListener("click",(function(){dp.clear(),delActiveColor("bg_chosen_day"),console.log("Data - ",t),e.classList.add("bg_chosen_day"),paginationAjax("#pagination",nameEventSearch,cityEventSearch,fromDateSearch=t,toDateSearch,categorySearch)}))}btnSearch.addEventListener("click",()=>searchEvent("event_name","city"));var allDateEl=document.querySelector(".all_days");function getCategories(){axios.get("https://eventafisha.com/api/v1/categories").then((function(e){for(let t in e.data)addCatToSearch(e.data[t],".container_category")})).catch((function(e){console.log(e)})).then((function(){}))}function addCatToSearch(e,t){let a=document.querySelector(t),n=document.createElement("div");n.classList.add("item_category"),n.setAttribute("category_id",e.id),n.innerHTML=e.title,a.appendChild(n),addEventToElement(n,e.id)}function addEventToElement(e,t){e.addEventListener("click",(function(){delActiveColor("color_active_cat"),console.log("CAT - ",t),e.classList.add("color_active_cat"),document.querySelector(".arrow_down").classList.add("color_active_cat"),paginationAjax("#pagination",nameEventSearch,cityEventSearch,fromDateSearch,toDateSearch,categorySearch=t)}))}allDateEl.addEventListener("click",(function(){delActiveColor("bg_chosen_day"),allDateEl.classList.add("bg_chosen_day")}));var arrElCat=[{el:document.querySelector("#search_cat_all"),id:""},{el:document.querySelector("#search_cat_main1"),id:4},{el:document.querySelector("#search_cat_main2"),id:5}];function addListenerToArrEl(e){for(let t in e)e[t].el.addEventListener("click",(function(){delActiveColor("color_active_cat"),e[t].el.classList.add("color_active_cat"),categorySearch=e[t].id,paginationAjax("#pagination",nameEventSearch,cityEventSearch,fromDateSearch,toDateSearch,categorySearch)}))}function delActiveColor(e){document.querySelectorAll("."+e).forEach((function(t){t.classList.remove(e)}))}function sliceText(e,t){let a=e.replace(/<\/?[^>]+>/g,"");return a=a.slice(0,t),a.length<e.length&&(a+="..."),a}addListenerToArrEl(arrElCat);let $btn=$(".datepicker_btn"),$input=$("#dp"),dp=$input.datepicker({showEvent:"none",range:!0,onSelect:function(e,t){console.log(e),splitSearchDate(e)},minDate:new Date}).data("datepicker");function splitSearchDate(e){if(delActiveColor("bg_chosen_day"),e.indexOf(" - ")>-1){let t=e.split(" - ");fromDateSearch=t[0],toDateSearch=t[1]}else fromDateSearch=e}$btn.on("click",(function(){dp.show(),dp.clear(),$input.focus()}));var fromDateSearch="",toDateSearch="",nameEventSearch="",cityEventSearch="",categorySearch="";function searchEvent(e,t,a,n){nameEventSearch=document.getElementById(e).value,cityEventSearch=document.getElementById(t).value,paginationAjax("#pagination",nameEventSearch,cityEventSearch,fromDateSearch,toDateSearch,categorySearch)}function removeEventList(){for(var e=document.querySelector(".container_events");e.firstChild;)e.removeChild(e.firstChild)}function checkSearchParam(e,t,a,n,c){let o="https://eventafisha.com/api/v1/events?paginate=";return""!==e&&(o+="&title="+e),""!==t&&(o+="&city_id="+t),""!==a&&(o+="&date_start="+a),""!==n&&(o+="&date_end="+n),""!==c&&(o+="&category_id="+c),o}function paginationAjax(e,t,a,n,c,o){let i=checkSearchParam(t,a,n,c,o);$(e).pagination({dataSource:i,locator:"data",totalNumberLocator:function(e){return console.log("test",e.total),e.total},pageSize:24,showPageNumbers:!0,showPrevious:!0,showNext:!0,showFirstOnEllipsisShow:!0,showLastOnEllipsisShow:!0,className:"paginationjs-theme paginationjs-small",alias:{pageNumber:"page",pageSize:"limit"},ajax:{},callback:function(e,t){console.log("response",e),0===e.length?modalNotFound.style.display="block":(removeEventList(),$.each(e,(function(e,t){createEventCard(t)})),window.scrollTo(0,0))}})}$((function(){paginationAjax("#pagination","","","","","")})),document.querySelector(".dropbtn").addEventListener("click",(function(){document.querySelector(".dropdown_content").classList.toggle("show")})),window.onclick=function(e){if(!e.target.matches(".dropbtn")){var t=document.querySelector(".dropdown_content");t.classList.contains("show")&&t.classList.remove("show")}};