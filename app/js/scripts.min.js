document.addEventListener("DOMContentLoaded",(function(){var e=[].slice.call(document.querySelectorAll("img.lazy")),t=[].slice.call(document.querySelectorAll(".lazy-background")),a=[].slice.call(document.querySelectorAll("[data-bg]"));if("IntersectionObserver"in window){let n=new IntersectionObserver((function(e,t){e.forEach((function(e){if(e.isIntersecting){let t=e.target;t.src=t.dataset.src,t.srcset=t.dataset.srcset,t.classList.remove("lazy"),n.unobserve(t)}}))}));e.forEach((function(e){n.observe(e)}));let o=new IntersectionObserver((function(e,t){e.forEach((function(e){e.isIntersecting&&(e.target.classList.add("visible"),o.unobserve(e.target))}))}));t.forEach((function(e){o.observe(e)}));let c=new IntersectionObserver((function(e,t){e.forEach((function(e){if(e.isIntersecting){let t=e.target;t.style.backgroundImage="url("+t.dataset.bg+")",c.unobserve(t)}}))}));a.forEach((function(e){c.observe(e)}))}else e.forEach((function(e){e.src=e.dataset.src,e.srcset=e.dataset.srcset})),t.forEach((function(e){e.classList.add("visible")})),a.forEach((function(e){e.style.backgroundImage="url("+e.dataset.bg+")"}))}));import{addOptionSelect}from"./helpers/help_create_elements.js";import{createEventCard}from"./helpers/help_create_elements.js";import{getCategories}from"./helpers/requests.js";import{getCities}from"./helpers/requests.js";import{getSubjects}from"./helpers/requests.js";import{addCatToSearch}from"./helpers/category_search_block.js";createBlockDate(),getCategoriesData(),getCitiesData(),getSubjectsData();var spinner=document.querySelector(".block_spinner"),modalNotFound=document.querySelector(".container_modal_notfound"),closeModalNotfound=document.querySelector(".close_modal_notfound");closeModalNotfound.addEventListener("click",(function(){modalNotFound.style.display="none",document.location.href="/"}));let btnSearch=document.querySelector(".btn_search");function getCitiesData(){getCities().then(e=>{for(let t in e.data)addOptionSelect(e.data[t],"city")}).catch(e=>{console.log(e)})}function getSubjectsData(){getSubjects().then(e=>{for(let t in e.data)addOptionSelect(e.data[t],"subject_search")}).catch(e=>{console.log(e)})}function getCategoriesData(){getCategories().then(e=>{for(let t in e.data)addCatToSearch(e.data[t],".container_category")}).catch(e=>{console.log(e)})}function createBlockDate(){for(let t=0;t<6;t++){var e=new Date;let a=e.setDate(e.getDate()+t);moment.locale("ru"),console.log(moment(a).format("DD")),console.log(moment(a).format("dd")),console.log(moment(a).format("DD.MM.YYYY")),createSearchDays(moment(a).format("dd"),moment(a).format("DD"),moment(a).format("DD.MM.YYYY"))}}function createSearchDays(e,t,a){let n;n="сб"===e||"вс"===e?'\n\t\t<div class="name_day red_text">'+e+'</div>\n\t\t<div class="count_day">'+t+"</div>\n\t":'\n\t\t<div class="name_day">'+e+'</div>\n\t\t<div class="count_day">'+t+"</div>\n\t";let o=document.querySelector(".block_search_day"),c=document.createElement("div");c.className="item_search_date",c.innerHTML=n,o.append(c),addEventElementDate(c,a)}function addEventElementDate(e,t){e.addEventListener("click",(function(){dp.clear(),delActiveColor("bg_chosen_day"),console.log("Data - ",t),e.classList.add("bg_chosen_day"),paginationAjax("#pagination",nameEventSearch,cityEventSearch,fromDateSearch=t,toDateSearch,categorySearch,subjectSearch)}))}btnSearch.addEventListener("click",()=>searchEvent("event_name","city","subject_search"));var allDateEl=document.querySelector(".all_days");allDateEl.addEventListener("click",(function(){delActiveColor("bg_chosen_day"),allDateEl.classList.add("bg_chosen_day"),paginationAjax("#pagination","","","","",categorySearch,subjectSearch)}));let $btn=$(".datepicker_btn"),$input=$("#dp"),dp=$input.datepicker({showEvent:"none",range:!0,onSelect:function(e,t){console.log(e),splitSearchDate(e)},minDate:new Date}).data("datepicker");function splitSearchDate(e){if(delActiveColor("bg_chosen_day"),e.indexOf(" - ")>-1){let t=e.split(" - ");fromDateSearch=t[0],toDateSearch=t[1]}else fromDateSearch=e}$btn.on("click",(function(){dp.show(),dp.clear(),$input.focus()}));export var fromDateSearch="";export var toDateSearch="";export var nameEventSearch="";export var cityEventSearch="";export var categorySearch="";export var subjectSearch="";export function setCategorySearch(e){categorySearch=e}function searchEvent(e,t,a){nameEventSearch=document.getElementById(e).value,cityEventSearch=document.getElementById(t).value,subjectSearch=document.getElementById(a).value,paginationAjax("#pagination",nameEventSearch,cityEventSearch,fromDateSearch,toDateSearch,categorySearch,subjectSearch)}function removeEventList(){for(var e=document.querySelector(".container_events");e.firstChild;)e.removeChild(e.firstChild)}function checkSearchParam(e,t,a,n,o,c){let r="https://eventafisha.com/api/v1/events?paginate=";return""!==e&&(r+="&title="+e),""!==t&&(r+="&city_id="+t),""!==a&&(r+="&date_start="+a),""!==n&&(r+="&date_end="+n),""!==o&&(r+="&category_id="+o),""!==c&&(r+="&subject_id="+c),r}$((function(){paginationAjax("#pagination","","","","","","")}));export function paginationAjax(e,t,a,n,o,c,r){let s=checkSearchParam(t,a,n,o,c,r);$(e).pagination({dataSource:s,locator:"data",totalNumberLocator:function(e){return console.log("test",e.total),e.total},pageSize:24,showPageNumbers:!0,showPrevious:!0,showNext:!0,showFirstOnEllipsisShow:!0,showLastOnEllipsisShow:!0,className:"paginationjs-theme paginationjs-small",alias:{pageNumber:"page",pageSize:"limit"},ajax:{beforeSend:function(){removeEventList(),spinner.classList.remove("hide_spinner")}},callback:function(e,t){spinner.classList.add("hide_spinner"),console.log("response",e),0===e.length?modalNotFound.style.display="block":(removeEventList(),$.each(e,(function(e,t){createEventCard(t)})),window.scrollTo(0,0))}})}